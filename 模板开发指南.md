# Cap4k DDD Codegen - Velocity æ¨¡æ¿å¼€å‘æŒ‡å—

## ä¸€ã€æ–‡æ¡£æ¦‚è¿°

### 1.1 ç›®æ ‡è¯»è€…

æœ¬æŒ‡å—é¢å‘éœ€è¦è‡ªå®šä¹‰ä»£ç ç”Ÿæˆæ¨¡æ¿çš„å¼€å‘è€…,åŒ…æ‹¬:

- ä½¿ç”¨ cap4k-ddd-codegen-gradle-plugin çš„é¡¹ç›®å¼€å‘è€…
- å¸Œæœ›æ‰©å±•ä»£ç ç”Ÿæˆèƒ½åŠ›çš„æ¶æ„å¸ˆ
- éœ€è¦å®šåˆ¶ä¼ä¸šçº§ä»£ç ç”Ÿæˆè§„èŒƒçš„æŠ€æœ¯å›¢é˜Ÿ

### 1.2 å‰ç½®çŸ¥è¯†

- âœ… Java/Kotlin åŸºç¡€
- âœ… Gradle æ„å»ºå·¥å…·
- âœ… DDD(é¢†åŸŸé©±åŠ¨è®¾è®¡)åŸºæœ¬æ¦‚å¿µ
- ğŸ”§ Apache Velocity æ¨¡æ¿è¯­æ³•(æœ¬æ–‡æ¡£ä¼šè¯¦ç»†è®²è§£)

### 1.3 æ–‡æ¡£ç»“æ„

1. Velocity è¯­æ³•å…¥é—¨
2. cap4k ä¸Šä¸‹æ–‡å˜é‡ç³»ç»Ÿ
3. æ¨¡æ¿å¼€å‘æœ€ä½³å®è·µ
4. å®æˆ˜æ¡ˆä¾‹:ä»é›¶å¼€å‘æ¨¡æ¿
5. å¸¸è§é—®é¢˜ä¸è°ƒè¯•æŠ€å·§

---

## äºŒã€Velocity è¯­æ³•å¿«é€Ÿå…¥é—¨

### 2.1 åŸºæœ¬è¯­æ³•

#### 2.1.1 å˜é‡è¾“å‡º

**åŸºæœ¬å˜é‡å¼•ç”¨**:

```velocity
## æ ‡å‡†è¾“å‡º
Hello, ${name}!

## é™é»˜è¾“å‡º(å˜é‡ä¸å­˜åœ¨æ—¶è¾“å‡ºç©ºå­—ç¬¦ä¸²,ä¸æŠ¥é”™)
Email: $!{email}

## é»˜è®¤å€¼(Velocity 2.0+)
${username.orElse("Guest")}
```

**ç¤ºä¾‹**:

```velocity
## ä¸Šä¸‹æ–‡: {name: "Alice", email: null}
Hello, ${name}!           â†’ Hello, Alice!
Email: $!{email}          â†’ Email:
Email: ${email}           â†’ æŠ¥é”™(ä¸¥æ ¼æ¨¡å¼ä¸‹)
```

---

#### 2.1.2 å±æ€§å’Œæ–¹æ³•è°ƒç”¨

**è®¿é—®å¯¹è±¡å±æ€§**:

```velocity
## è®¿é—®å±æ€§
${user.name}
${user.age}

## è°ƒç”¨æ–¹æ³•
${user.getName()}
${user.isActive()}

## é“¾å¼è°ƒç”¨
${user.getAddress().getCity()}
```

**cap4k å®ä¾‹**:

```velocity
## Field å¯¹è±¡
${field.fieldName}        â†’ å­—æ®µå
${field.javaType}         â†’ Java ç±»å‹
${field.comment}          â†’ æ³¨é‡Š
${field.isPrimaryKey}     â†’ æ˜¯å¦ä¸»é”®
```

---

#### 2.1.3 æ¡ä»¶åˆ¤æ–­

**if-else è¯­å¥**:

```velocity
#if($user.age >= 18)
    Adult user
#elseif($user.age >= 13)
    Teenager
#else
    Child
#end
```

**é€»è¾‘è¿ç®—ç¬¦**:

```velocity
#if($user && $user.isActive())
    Active user
#end

#if($age > 18 && $age < 65)
    Working age
#end

#if(!$user.isBlocked())
    User is not blocked
#end
```

**cap4k å®ä¾‹**:

```velocity
#if($field.isPrimaryKey)
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
#end

#if($field.nullable)
    @Column(name = "${field.columnName}", nullable = true)
#else
    @Column(name = "${field.columnName}", nullable = false)
#end
```

---

#### 2.1.4 å¾ªç¯éå†

**foreach å¾ªç¯**:

```velocity
#foreach($item in $list)
    - $item
#end
```

**å¾ªç¯å·¥å…·å˜é‡**:

```velocity
#foreach($field in $fields)
    Field ${foreach.count}: ${field.name}
    Index: ${foreach.index}
    #if($foreach.hasNext), #end
#end
```

| å˜é‡               | è¯´æ˜       | èµ·å§‹å€¼     |
|------------------|----------|---------|
| $foreach.count   | å¾ªç¯è®¡æ•°     | 1       |
| $foreach.index   | å¾ªç¯ç´¢å¼•     | 0       |
| $foreach.hasNext | æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´  | boolean |
| $foreach.first   | æ˜¯å¦ç¬¬ä¸€ä¸ªå…ƒç´   | boolean |
| $foreach.last    | æ˜¯å¦æœ€åä¸€ä¸ªå…ƒç´  | boolean |

**cap4k å®ä¾‹**:

```velocity
## ç”Ÿæˆå­—æ®µå®šä¹‰
#foreach($field in $fields)
    /**
     * ${field.comment}
     */
    private ${field.javaType} ${field.fieldName};
#end

## ç”Ÿæˆå¯¼å…¥è¯­å¥(å»é‡ã€æ’åº)
#foreach($import in $importList)
import ${import};
#end

## ç”Ÿæˆé€—å·åˆ†éš”åˆ—è¡¨
#foreach($entity in $entities)
${entity.name}#if($foreach.hasNext), #end
#end
```

---

#### 2.1.5 å˜é‡å®šä¹‰

**set æŒ‡ä»¤**:

```velocity
## å®šä¹‰å˜é‡
#set($title = "User Management")
#set($version = 1.0)

## è®¡ç®—è¡¨è¾¾å¼
#set($sum = $a + $b)
#set($fullName = "${firstName} ${lastName}")

## å®šä¹‰é›†åˆ
#set($colors = ["red", "green", "blue"])
#set($map = {"key1": "value1", "key2": "value2"})
```

**cap4k å®ä¾‹**:

```velocity
## æ ‡å¿—å˜é‡
#set($hasDateField = false)
#foreach($field in $fields)
    #if($field.javaType == "Date" || $field.javaType == "LocalDateTime")
        #set($hasDateField = true)
    #end
#end

## æ¡ä»¶å¯¼å…¥
#if($hasDateField)
import java.time.LocalDateTime;
#end
```

---

#### 2.1.6 å®å®šä¹‰

**macro æŒ‡ä»¤**:

```velocity
## å®šä¹‰å®
#macro(field $type $name $comment)
    /**
     * ${comment}
     */
    private ${type} ${name};
#end

## è°ƒç”¨å®
#field("Long" "id" "ç”¨æˆ·ID")
#field("String" "name" "ç”¨æˆ·å")
```

**å¸¦é»˜è®¤å€¼çš„å®**:

```velocity
#macro(getter $type $name $prefix = "get")
    public ${type} ${prefix}${name.substring(0,1).toUpperCase()}${name.substring(1)}() {
        return this.${name};
    }
#end

#getter("String" "name")          â†’ getName()
#getter("boolean" "active" "is")  â†’ isActive()
```

---

#### 2.1.7 æ¨¡æ¿å¼•å…¥

**parse æŒ‡ä»¤**(è§£æ Velocity å†…å®¹):

```velocity
#parse("vm/common/header.vm")
#parse("vm/common/imports.vm")
```

**include æŒ‡ä»¤**(åŸæ ·æ’å…¥,ä¸è§£æ):

```velocity
#include("vm/static/license.txt")
```

---

#### 2.1.8 æ³¨é‡Š

```velocity
## å•è¡Œæ³¨é‡Š(ä¸ä¼šè¾“å‡ºåˆ°ç»“æœ)

#*
å¤šè¡Œæ³¨é‡Š
ä¸ä¼šè¾“å‡ºåˆ°ç»“æœ
*#

#**
æ–‡æ¡£æ³¨é‡Š
é€šå¸¸ç”¨äºå®å’ŒæŒ‡ä»¤çš„è¯´æ˜
*#
```

---

#### 2.1.9 è½¬ä¹‰

**è½¬ä¹‰ Velocity è¯­æ³•**:

```velocity
## æ–¹å¼1:ä½¿ç”¨åæ–œæ 
\${notAVariable}      â†’ ${notAVariable}

## æ–¹å¼2:ä½¿ç”¨ #[[ ]]#
#[[
è¿™é‡Œçš„ ${content} ä¸ä¼šè¢«è§£æ
${variable} åŸæ ·è¾“å‡º
]]#
```

**cap4k ç‰¹æ®Šè½¬ä¹‰ç¬¦å·**:

```velocity
## cap4k æä¾›çš„è½¬ä¹‰ç¬¦å·
${symbol_pound}       â†’ #
${symbol_dollar}      â†’ $
${symbol_escape}      â†’ \

## ä½¿ç”¨åœºæ™¯:ç”Ÿæˆ Markdown æ–‡æ¡£
${symbol_pound} Title
${symbol_pound}${symbol_pound} Subtitle
```

---

### 2.2 è¿›é˜¶è¯­æ³•

#### 2.2.1 èŒƒå›´å¾ªç¯

```velocity
#foreach($i in [1..5])
    Number: $i
#end

#foreach($i in [1..$max])
    Index: $i
#end
```

---

#### 2.2.2 å­—ç¬¦ä¸²æ“ä½œ

```velocity
## å­—ç¬¦ä¸²æ‹¼æ¥
#set($fullPath = "${basePackage}.${moduleName}.domain")

## å­ä¸²
${name.substring(0, 3)}

## å¤§å°å†™è½¬æ¢
${name.toLowerCase()}
${name.toUpperCase()}

## é¦–å­—æ¯å¤§å°å†™
${name.substring(0,1).toUpperCase()}${name.substring(1)}  ## é¦–å­—æ¯å¤§å†™
${name.substring(0,1).toLowerCase()}${name.substring(1)}  ## é¦–å­—æ¯å°å†™
```

---

#### 2.2.3 é›†åˆæ“ä½œ

```velocity
## åˆ—è¡¨å¤§å°
Size: ${list.size()}

## åˆ¤ç©º
#if($list && $list.size() > 0)
    List is not empty
#end

## åŒ…å«åˆ¤æ–­
#if($list.contains("item"))
    Found
#end
```

---

#### 2.2.4 æ•°å­¦è¿ç®—

```velocity
## ç®—æœ¯è¿ç®—
#set($sum = $a + $b)
#set($diff = $a - $b)
#set($product = $a * $b)
#set($quotient = $a / $b)
#set($remainder = $a % $b)

## æ¯”è¾ƒè¿ç®—
#if($a == $b)
#if($a != $b)
#if($a > $b)
#if($a >= $b)
#if($a < $b)
#if($a <= $b)
```

---

## ä¸‰ã€Cap4k ä¸Šä¸‹æ–‡å˜é‡ç³»ç»Ÿ

### 3.1 å˜é‡åˆ†ç±»

cap4k æä¾›çš„ä¸Šä¸‹æ–‡å˜é‡åˆ†ä¸ºä»¥ä¸‹å‡ ç±»:

| ç±»åˆ«   | è¯´æ˜        | ç¤ºä¾‹å˜é‡                        |
|------|-----------|-----------------------------|
| åŸºç¡€ä¿¡æ¯ | é¡¹ç›®å’Œæ¨¡å—åŸºæœ¬ä¿¡æ¯ | basePackage, moduleName     |
| å®ä½“ä¿¡æ¯ | æ•°æ®åº“è¡¨å’Œå®ä½“ä¿¡æ¯ | tableName, className        |
| å­—æ®µé›†åˆ | å­—æ®µåˆ—è¡¨å’Œå…³è”æ•°æ® | fields, entities            |
| å·¥å…·ç±»  | è¾…åŠ©å·¥å…·å¯¹è±¡    | StringUtils, DateUtils      |
| è½¬ä¹‰ç¬¦å· | ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰    | symbol_pound, symbol_dollar |

---

### 3.2 åŸºç¡€ä¿¡æ¯å˜é‡

| å˜é‡å                  | ç±»å‹     | è¯´æ˜          | ç¤ºä¾‹                |
|----------------------|--------|-------------|-------------------|
| basePackage          | String | é¡¹ç›®åŸºç¡€åŒ…å      | com.only4.example |
| basePackage__as_path | String | åŒ…åè½¬è·¯å¾„(ç”¨äºç›®å½•) | com/only4/example |
| moduleName           | String | æ¨¡å—åç§°        | user              |
| aggregateName        | String | èšåˆåç§°        | User              |
| author               | String | ä»£ç ä½œè€…        | cap4k-codegen     |
| datetime             | String | ç”Ÿæˆæ—¥æœŸæ—¶é—´      | 2024-12-21        |
| outputDir            | String | è¾“å‡ºç›®å½•        | src/main/java     |

**ä½¿ç”¨ç¤ºä¾‹**:

```velocity
package ${basePackage}.${moduleName}.domain;

/**
 * ${aggregateName} Entity
 *
 * @author ${author}
 * @date ${datetime}
 */
public class ${className} {
    // ...
}
```

**ç”Ÿæˆç»“æœ**:

```java
package com.only4.example.user.domain;

/**
 * User Entity
 *
 * @author cap4k-codegen
 * @date 2024-12-21
 */
public class User {
    // ...
}
```

---

### 3.3 å®ä½“ä¿¡æ¯å˜é‡

| å˜é‡å           | ç±»å‹      | è¯´æ˜    | ç¤ºä¾‹     |
|---------------|---------|-------|--------|
| tableName     | String  | æ•°æ®åº“è¡¨å | t_user |
| className     | String  | å®ä½“ç±»å  | User   |
| entityName    | String  | å®ä½“åç§°  | User   |
| entityComment | String  | å®ä½“æ³¨é‡Š  | ç”¨æˆ·å®ä½“   |
| isRoot        | Boolean | æ˜¯å¦èšåˆæ ¹ | true   |
| idType        | String  | ä¸»é”®ç±»å‹  | Long   |
| idFieldName   | String  | ä¸»é”®å­—æ®µå | id     |

**ä½¿ç”¨ç¤ºä¾‹**:

```velocity
@Entity
@Table(name = "${tableName}")
@Aggregate(
    aggregate = "${aggregateName}",
    type = "entity",
    name = "${entityName}",
    root = ${isRoot}
)
public class ${className} extends AggregateRoot<${idType}> {
    // ...
}
```

---

### 3.4 å­—æ®µé›†åˆå˜é‡

#### 3.4.1 fields å˜é‡(å­—æ®µåˆ—è¡¨)

**ç±»å‹**: `List<Field>`

**Field å¯¹è±¡å±æ€§**:
| å±æ€§å | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| fieldName | String | Java å­—æ®µå(é©¼å³°) | userId |
| columnName | String | æ•°æ®åº“åˆ—å(ä¸‹åˆ’çº¿) | user_id |
| javaType | String | Java ç±»å‹ | Long |
| jdbcType | String | JDBC ç±»å‹ | BIGINT |
| comment | String | å­—æ®µæ³¨é‡Š | ç”¨æˆ·ID |
| isPrimaryKey | Boolean | æ˜¯å¦ä¸»é”® | true |
| nullable | Boolean | æ˜¯å¦å¯ç©º | false |
| length | Int | å­—æ®µé•¿åº¦ | 255 |
| precision | Int | æ•°å€¼ç²¾åº¦ | 10 |
| scale | Int | å°æ•°ä½æ•° | 2 |
| defaultValue | String | é»˜è®¤å€¼ | 0 |

**ä½¿ç”¨ç¤ºä¾‹**:

```velocity
#foreach($field in $fields)
    /**
     * ${field.comment}
     */
    #if($field.isPrimaryKey)
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    #end
    @Column(name = "${field.columnName}"#if($field.length), length = ${field.length}#end#if(!$field.nullable), nullable = false#end)
    private ${field.javaType} ${field.fieldName};

#end
```

**ç”Ÿæˆç»“æœ**:

```java
    /**
 * ç”¨æˆ·ID
 */
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
@Column(name = "user_id", nullable = false)
private Long userId;

/**
 * ç”¨æˆ·å
 */
@Column(name = "username", length = 50, nullable = false)
private String username;
```

---

#### 3.4.2 entities å˜é‡(å®ä½“åˆ—è¡¨)

**ç±»å‹**: `List<Entity>`

**Entity å¯¹è±¡å±æ€§**:
| å±æ€§å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| name | String | å®ä½“åç§° |
| className | String | ç±»å |
| tableName | String | è¡¨å |
| comment | String | æ³¨é‡Š |
| isRoot | Boolean | æ˜¯å¦èšåˆæ ¹ |
| fields | List<Field> | å­—æ®µåˆ—è¡¨ |

**ä½¿ç”¨ç¤ºä¾‹**:

```velocity
## ç”Ÿæˆèšåˆæ–‡æ¡£
# ${aggregateName} èšåˆ

## å®ä½“åˆ—è¡¨
#foreach($entity in $entities)
- **${entity.name}**: ${entity.comment} (è¡¨: ${entity.tableName})
#end
```

---

#### 3.4.3 importList å˜é‡(å¯¼å…¥åŒ…åˆ—è¡¨)

**ç±»å‹**: `Set<String>`

**ä½¿ç”¨ç¤ºä¾‹**:

```velocity
package ${basePackage}.${moduleName}.domain;

## å¯¼å…¥è¯­å¥
#foreach($import in $importList)
import ${import};
#end

public class ${className} {
    // ...
}
```

---

### 3.5 å·¥å…·ç±»å˜é‡

#### 3.5.1 StringUtils(å­—ç¬¦ä¸²å·¥å…·)

**æ–¹æ³•åˆ—è¡¨**:
| æ–¹æ³• | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| capitalize(str) | é¦–å­—æ¯å¤§å†™ | capitalize("user") â†’ "User" |
| uncapitalize(str) | é¦–å­—æ¯å°å†™ | uncapitalize("User") â†’ "user" |
| camelToSnake(str) | é©¼å³°è½¬ä¸‹åˆ’çº¿ | camelToSnake("userId") â†’ "user_id" |
| snakeToCamel(str) | ä¸‹åˆ’çº¿è½¬é©¼å³° | snakeToCamel("user_id") â†’ "userId" |

**ä½¿ç”¨ç¤ºä¾‹**:

```velocity
## ç”Ÿæˆ getter æ–¹æ³•
public ${field.javaType} get${StringUtils.capitalize(field.fieldName)}() {
    return this.${field.fieldName};
}

## ç”Ÿæˆæ•°æ®åº“åˆ—å
@Column(name = "${StringUtils.camelToSnake(field.fieldName)}")
```

---

#### 3.5.2 DateUtils(æ—¥æœŸå·¥å…·)

**æ–¹æ³•åˆ—è¡¨**:
| æ–¹æ³• | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| now() | å½“å‰æ—¥æœŸ(yyyy-MM-dd) | "2024-12-21" |
| datetime() | å½“å‰æ—¥æœŸæ—¶é—´ | "2024-12-21 10:30:00" |
| year() | å½“å‰å¹´ä»½ | "2024" |

---

#### 3.5.3 TypeUtils(ç±»å‹å·¥å…·)

**æ–¹æ³•åˆ—è¡¨**:
| æ–¹æ³• | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| isString(type) | æ˜¯å¦å­—ç¬¦ä¸²ç±»å‹ | true |
| isNumber(type) | æ˜¯å¦æ•°å­—ç±»å‹ | true |
| isDate(type) | æ˜¯å¦æ—¥æœŸç±»å‹ | true |
| isBoolean(type) | æ˜¯å¦å¸ƒå°”ç±»å‹ | true |

**ä½¿ç”¨ç¤ºä¾‹**:

```velocity
#if($TypeUtils.isDate($field.javaType))
import java.time.LocalDateTime;
#end
```

---

### 3.6 è½¬ä¹‰ç¬¦å·å˜é‡

| å˜é‡å           | è¾“å‡º | ç”¨é€”          |
|---------------|----|-------------|
| symbol_pound  | #  | Markdown æ ‡é¢˜ |
| symbol_dollar | $  | å­—ç¬¦ä¸²æ¨¡æ¿       |
| symbol_escape | \  | è½¬ä¹‰å­—ç¬¦        |

**ä½¿ç”¨ç¤ºä¾‹**:

```velocity
${symbol_pound} ${aggregateName} èšåˆ

${symbol_pound}${symbol_pound} æ¦‚è¿°
æœ¬èšåˆåŒ…å«ä»¥ä¸‹å®ä½“:
#foreach($entity in $entities)
- ${entity.name}
#end
```

**ç”Ÿæˆç»“æœ**:

```markdown
# User èšåˆ

## æ¦‚è¿°

æœ¬èšåˆåŒ…å«ä»¥ä¸‹å®ä½“:

- User
- UserProfile
```

---

## å››ã€æ¨¡æ¿å¼€å‘æœ€ä½³å®è·µ

### 4.1 æ¨¡æ¿æ–‡ä»¶ç»„ç»‡

#### 4.1.1 ç›®å½•ç»“æ„è§„èŒƒ

**æ¨èç»“æ„**:

```
resources/vm/
â”œâ”€â”€ entity/                 # å®ä½“ç±»æ¨¡æ¿
â”‚   â”œâ”€â”€ entity.java.vm
â”‚   â”œâ”€â”€ entity.kt.vm
â”‚   â””â”€â”€ enum.java.vm
â”œâ”€â”€ aggregate/              # èšåˆæ¨¡æ¿
â”‚   â”œâ”€â”€ aggregate.md.vm
â”‚   â””â”€â”€ factory.java.vm
â”œâ”€â”€ repository/             # ä»“å‚¨æ¨¡æ¿
â”‚   â”œâ”€â”€ repository.java.vm
â”‚   â””â”€â”€ jpa-impl.java.vm
â”œâ”€â”€ common/                 # å…¬å…±æ¨¡æ¿
â”‚   â”œâ”€â”€ header.vm           # æ–‡ä»¶å¤´
â”‚   â”œâ”€â”€ imports.vm          # å¯¼å…¥è¯­å¥
â”‚   â””â”€â”€ macros.vm           # å®å®šä¹‰
â””â”€â”€ custom/                 # è‡ªå®šä¹‰æ¨¡æ¿
    â””â”€â”€ my-template.vm
```

---

#### 4.1.2 æ¨¡æ¿å‘½åè§„èŒƒ

**æ ¼å¼**: `<ç”¨é€”>.<è¯­è¨€>.<åç¼€>.vm`

**ç¤ºä¾‹**:

- `entity.java.vm` - Java å®ä½“ç±»æ¨¡æ¿
- `entity.kt.vm` - Kotlin å®ä½“ç±»æ¨¡æ¿
- `aggregate.md.vm` - èšåˆ Markdown æ–‡æ¡£æ¨¡æ¿
- `repository-interface.java.vm` - ä»“å‚¨æ¥å£æ¨¡æ¿

---

### 4.2 ä»£ç é£æ ¼è§„èŒƒ

#### 4.2.1 ç¼©è¿›å’Œæ ¼å¼

**è§„åˆ™**:

1. ä½¿ç”¨ 4 ç©ºæ ¼ç¼©è¿›
2. Velocity æŒ‡ä»¤ç‹¬å ä¸€è¡Œ
3. å—ç»“æŸæ ‡è®° `#end` ç‹¬å ä¸€è¡Œ

**âœ… æ¨è**:

```velocity
#foreach($field in $fields)
    /**
     * ${field.comment}
     */
    private ${field.javaType} ${field.fieldName};

#end
```

**âŒ ä¸æ¨è**:

```velocity
#foreach($field in $fields)/**${field.comment}*/private ${field.javaType} ${field.fieldName};#end
```

---

#### 4.2.2 æ³¨é‡Šè§„èŒƒ

**è§„åˆ™**:

1. æ¨¡æ¿æ–‡ä»¶å¤´éƒ¨æ·»åŠ è¯´æ˜æ³¨é‡Š
2. å¤æ‚é€»è¾‘æ·»åŠ è¡Œå†…æ³¨é‡Š
3. ä½¿ç”¨ `##` æ³¨é‡Š,ä¸ä½¿ç”¨ `#* *#`(é¿å…å¹²æ‰°æ ¼å¼)

**ç¤ºä¾‹**:

```velocity
##
## Cap4k DDD Codegen - Entity Template
## ç”¨é€”: ç”Ÿæˆ JPA å®ä½“ç±»
## ä½œè€…: cap4k-codegen
## ç‰ˆæœ¬: 1.0
##

package ${basePackage}.${moduleName}.domain.entity;

## å¯¼å…¥åŸºç¡€ç±»
import com.only4.cap4k.ddd.core.domain.aggregate.AggregateRoot;
import lombok.Data;

## æ¡ä»¶å¯¼å…¥:æ—¥æœŸç±»å‹
#if($hasDateField)
import java.time.LocalDateTime;
#end

/**
 * ${entityComment}
 */
@Data
public class ${className} extends AggregateRoot<${idType}> {
    ## å­—æ®µå®šä¹‰
    #foreach($field in $fields)
        ## è·³è¿‡åŸºç±»å­—æ®µ
        #if(!$field.isSuperField)
    private ${field.javaType} ${field.fieldName};
        #end
    #end
}
```

---

#### 4.2.3 å˜é‡å‘½å

**è§„åˆ™**:

1. ä¸Šä¸‹æ–‡å˜é‡ä½¿ç”¨é©¼å³°å‘½å
2. å±€éƒ¨å˜é‡ä½¿ç”¨å°å†™+ä¸‹åˆ’çº¿
3. å¸ƒå°”å˜é‡ä½¿ç”¨ `is/has` å‰ç¼€

**ç¤ºä¾‹**:

```velocity
## ä¸Šä¸‹æ–‡å˜é‡(é©¼å³°)
${className}
${moduleName}
${basePackage}

## å±€éƒ¨å˜é‡(ä¸‹åˆ’çº¿)
#set($has_date_field = false)
#set($import_list = [])

## å¸ƒå°”å˜é‡(is/has å‰ç¼€)
#set($isRoot = true)
#set($hasChildren = false)
```

---

### 4.3 æ€§èƒ½ä¼˜åŒ–

#### 4.3.1 é¿å…é‡å¤è®¡ç®—

**âŒ ä¸æ¨è**:

```velocity
#foreach($field in $fields)
    #if($field.javaType.substring(0,1).toUpperCase() == "S")
        ## æ¯æ¬¡å¾ªç¯éƒ½è°ƒç”¨ substring å’Œ toUpperCase
    #end
#end
```

**âœ… æ¨è**:

```velocity
#foreach($field in $fields)
    #set($firstChar = $field.javaType.substring(0,1).toUpperCase())
    #if($firstChar == "S")
        ## åªè®¡ç®—ä¸€æ¬¡
    #end
#end
```

---

#### 4.3.2 åˆç†ä½¿ç”¨å®

**åœºæ™¯**: é‡å¤ä»£ç ç‰‡æ®µ

**ç¤ºä¾‹**:

```velocity
## å®šä¹‰å®
#macro(fieldAnnotation $field)
    #if($field.isPrimaryKey)
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    #end
    @Column(name = "${field.columnName}"#if(!$field.nullable), nullable = false#end)
#end

## ä½¿ç”¨å®
#foreach($field in $fields)
    #fieldAnnotation($field)
    private ${field.javaType} ${field.fieldName};
#end
```

---

### 4.4 å¯ç»´æŠ¤æ€§

#### 4.4.1 æ¨¡å—åŒ–è®¾è®¡

**æ‹†åˆ†å¤§æ¨¡æ¿**:

```velocity
## main.java.vm
#parse("vm/common/header.vm")
#parse("vm/common/imports.vm")

public class ${className} {
    #parse("vm/entity/fields.vm")
    #parse("vm/entity/methods.vm")
}
```

**ä¼˜ç‚¹**:

- é™ä½å•æ–‡ä»¶å¤æ‚åº¦
- æé«˜å¤ç”¨æ€§
- ä¾¿äºç»´æŠ¤

---

#### 4.4.2 ä½¿ç”¨å…¬å…±å®åº“

**åˆ›å»º vm/common/macros.vm**:

```velocity
##
## å…¬å…±å®å®šä¹‰åº“
##

## å­—æ®µå®šä¹‰å®
#macro(field $type $name $comment)
    /**
     * ${comment}
     */
    private ${type} ${name};
#end

## Getter æ–¹æ³•å®
#macro(getter $type $name)
    public ${type} get${name.substring(0,1).toUpperCase()}${name.substring(1)}() {
        return this.${name};
    }
#end

## Setter æ–¹æ³•å®
#macro(setter $type $name)
    public void set${name.substring(0,1).toUpperCase()}${name.substring(1)}(${type} ${name}) {
        this.${name} = ${name};
    }
#end
```

**åœ¨æ¨¡æ¿ä¸­å¼•ç”¨**:

```velocity
#parse("vm/common/macros.vm")

public class ${className} {
    #foreach($field in $fields)
        #field($field.javaType $field.fieldName $field.comment)
    #end

    #foreach($field in $fields)
        #getter($field.javaType $field.fieldName)
        #setter($field.javaType $field.fieldName)
    #end
}
```

---

## äº”ã€å®æˆ˜æ¡ˆä¾‹:ä»é›¶å¼€å‘æ¨¡æ¿

### 5.1 éœ€æ±‚åˆ†æ

**ç›®æ ‡**: å¼€å‘ä¸€ä¸ªç”Ÿæˆ Spring Data JPA Repository æ¥å£çš„æ¨¡æ¿

**éœ€æ±‚**:

1. ç”Ÿæˆä»“å‚¨æ¥å£,ç»§æ‰¿ `JpaRepository`
2. æ·»åŠ è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•
3. æ ¹æ®å­—æ®µè‡ªåŠ¨ç”Ÿæˆ `findBy` æ–¹æ³•
4. æ”¯æŒåˆ†é¡µå’Œæ’åº

---

### 5.2 è®¾è®¡æ¨¡æ¿ç»“æ„

**æ¨¡æ¿æ–‡ä»¶**: `vm/repository/jpa-repository.java.vm`

**æ‰€éœ€ä¸Šä¸‹æ–‡å˜é‡**:

- `basePackage`: åŸºç¡€åŒ…å
- `moduleName`: æ¨¡å—å
- `className`: å®ä½“ç±»å
- `idType`: ä¸»é”®ç±»å‹
- `fields`: å­—æ®µåˆ—è¡¨
- `queryFields`: å¯æŸ¥è¯¢å­—æ®µåˆ—è¡¨

---

### 5.3 ç¼–å†™æ¨¡æ¿

**Step 1: æ–‡ä»¶å¤´å’ŒåŒ…å£°æ˜**:

```velocity
##
## Cap4k DDD Codegen - JPA Repository Template
## ç”¨é€”: ç”Ÿæˆ Spring Data JPA Repository æ¥å£
##

package ${basePackage}.${moduleName}.repository;

import ${basePackage}.${moduleName}.domain.entity.${className};
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;
```

---

**Step 2: æ¥å£å®šä¹‰**:

```velocity
/**
 * ${className} ä»“å‚¨æ¥å£
 *
 * @author ${author}
 * @date ${datetime}
 */
@Repository
public interface ${className}Repository extends JpaRepository<${className}, ${idType}> {
```

---

**Step 3: ç”ŸæˆæŸ¥è¯¢æ–¹æ³•**:

```velocity
    ## æ ¹æ®å¯æŸ¥è¯¢å­—æ®µç”Ÿæˆ findBy æ–¹æ³•
    #foreach($field in $queryFields)
        #if(!$field.isPrimaryKey)
    /**
     * æ ¹æ® ${field.comment} æŸ¥è¯¢
     */
    Optional<${className}> findBy${StringUtils.capitalize($field.fieldName)}(${field.javaType} ${field.fieldName});

        #end
    #end
```

---

**Step 4: ç”Ÿæˆåˆ—è¡¨æŸ¥è¯¢æ–¹æ³•**:

```velocity
    ## ç”Ÿæˆåˆ—è¡¨æŸ¥è¯¢æ–¹æ³•
    #foreach($field in $queryFields)
        #if($TypeUtils.isString($field.javaType))
    /**
     * æ ¹æ® ${field.comment} æ¨¡ç³ŠæŸ¥è¯¢
     */
    @Query("SELECT e FROM ${className} e WHERE e.${field.fieldName} LIKE %:${field.fieldName}%")
    List<${className}> findBy${StringUtils.capitalize($field.fieldName)}Containing(@Param("${field.fieldName}") String ${field.fieldName});

        #end
    #end
```

---

**Step 5: ç»“æŸ**:

```velocity
}
```

---

### 5.4 å®Œæ•´æ¨¡æ¿ä»£ç 

**vm/repository/jpa-repository.java.vm**:

```velocity
##
## Cap4k DDD Codegen - JPA Repository Template
##

package ${basePackage}.${moduleName}.repository;

import ${basePackage}.${moduleName}.domain.entity.${className};
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

/**
 * ${className} ä»“å‚¨æ¥å£
 *
 * @author ${author}
 * @date ${datetime}
 */
@Repository
public interface ${className}Repository extends JpaRepository<${className}, ${idType}> {

    ## æ ¹æ®å¯æŸ¥è¯¢å­—æ®µç”Ÿæˆ findBy æ–¹æ³•
    #foreach($field in $queryFields)
        #if(!$field.isPrimaryKey)
    /**
     * æ ¹æ® ${field.comment} æŸ¥è¯¢
     */
    Optional<${className}> findBy${StringUtils.capitalize($field.fieldName)}(${field.javaType} ${field.fieldName});

        #end
    #end

    ## ç”Ÿæˆåˆ—è¡¨æŸ¥è¯¢æ–¹æ³•
    #foreach($field in $queryFields)
        #if($TypeUtils.isString($field.javaType))
    /**
     * æ ¹æ® ${field.comment} æ¨¡ç³ŠæŸ¥è¯¢
     */
    @Query("SELECT e FROM ${className} e WHERE e.${field.fieldName} LIKE %:${field.fieldName}%")
    List<${className}> findBy${StringUtils.capitalize($field.fieldName)}Containing(@Param("${field.fieldName}") String ${field.fieldName});

        #end
    #end
}
```

---

### 5.5 æµ‹è¯•æ¨¡æ¿

**æµ‹è¯•ä»£ç **:

```kotlin
@Test
fun `test jpa repository template`() {
    val context = mapOf(
        "basePackage" to "com.only4.example",
        "moduleName" to "user",
        "className" to "User",
        "idType" to "Long",
        "author" to "cap4k-codegen",
        "datetime" to "2024-12-21",
        "queryFields" to listOf(
            mapOf(
                "fieldName" to "username",
                "javaType" to "String",
                "comment" to "ç”¨æˆ·å",
                "isPrimaryKey" to false
            ),
            mapOf(
                "fieldName" to "email",
                "javaType" to "String",
                "comment" to "é‚®ç®±",
                "isPrimaryKey" to false
            )
        )
    )

    val velocityContext = VelocityContextBuilder.create(context)
    val result = VelocityTemplateRenderer.INSTANCE.render(
        "vm/repository/jpa-repository.java.vm",
        velocityContext
    )

    println(result)

    // éªŒè¯ç”Ÿæˆå†…å®¹
    assertTrue(result.contains("interface UserRepository"))
    assertTrue(result.contains("findByUsername"))
    assertTrue(result.contains("findByUsernameContaining"))
}
```

---

### 5.6 ç”Ÿæˆç»“æœ

**ç”Ÿæˆçš„ UserRepository.java**:

```java
package com.only4.example.user.repository;

import com.only4.example.user.domain.entity.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

/**
 * User ä»“å‚¨æ¥å£
 *
 * @author cap4k-codegen
 * @date 2024-12-21
 */
@Repository
public interface UserRepository extends JpaRepository<User, Long> {

    /**
     * æ ¹æ® ç”¨æˆ·å æŸ¥è¯¢
     */
    Optional<User> findByUsername(String username);

    /**
     * æ ¹æ® é‚®ç®± æŸ¥è¯¢
     */
    Optional<User> findByEmail(String email);

    /**
     * æ ¹æ® ç”¨æˆ·å æ¨¡ç³ŠæŸ¥è¯¢
     */
    @Query("SELECT e FROM User e WHERE e.username LIKE %:username%")
    List<User> findByUsernameContaining(@Param("username") String username);

    /**
     * æ ¹æ® é‚®ç®± æ¨¡ç³ŠæŸ¥è¯¢
     */
    @Query("SELECT e FROM User e WHERE e.email LIKE %:email%")
    List<User> findByEmailContaining(@Param("email") String email);
}
```

---

## å…­ã€å¸¸è§é—®é¢˜ä¸è°ƒè¯•æŠ€å·§

### 6.1 è¯­æ³•é”™è¯¯è°ƒè¯•

#### é—®é¢˜1: å˜é‡æœªå®šä¹‰

**é”™è¯¯ä¿¡æ¯**:

```
Velocity template syntax error in vm/entity/entity.java.vm:
  Unable to find resource 'fields'
```

**åŸå› **: ä¸Šä¸‹æ–‡ä¸­ç¼ºå°‘ `fields` å˜é‡

**è§£å†³æ–¹æ¡ˆ**:

```kotlin
// æ£€æŸ¥ä¸Šä¸‹æ–‡å˜é‡
val context = mapOf(
    "className" to "User",
    "fields" to listOf(...
)  // ç¡®ä¿ fields å˜é‡å­˜åœ¨
)
```

---

#### é—®é¢˜2: æŒ‡ä»¤æ‹¼å†™é”™è¯¯

**é”™è¯¯æ¨¡æ¿**:

```velocity
#forech($field in $fields)  ## æ‹¼å†™é”™è¯¯: forech
    ${field.name}
#end
```

**é”™è¯¯ä¿¡æ¯**:

```
Encountered "#forech" at line 1, column 1.
Was expecting one of:
    "#foreach" ...
```

**è§£å†³æ–¹æ¡ˆ**: ä¿®æ­£æ‹¼å†™ä¸º `#foreach`

---

#### é—®é¢˜3: æ‹¬å·ä¸åŒ¹é…

**é”™è¯¯æ¨¡æ¿**:

```velocity
#if($field.isPrimaryKey
    @Id
#end
```

**é”™è¯¯ä¿¡æ¯**:

```
Encountered ")" at line 2, column 1.
Was expecting: ")"
```

**è§£å†³æ–¹æ¡ˆ**: è¡¥å…¨æ‹¬å· `#if($field.isPrimaryKey)`

---

### 6.2 é€»è¾‘é”™è¯¯è°ƒè¯•

#### æŠ€å·§1: è¾“å‡ºè°ƒè¯•ä¿¡æ¯

```velocity
## è°ƒè¯•:è¾“å‡ºå˜é‡å€¼
DEBUG: className = ${className}
DEBUG: fields size = ${fields.size()}

#foreach($field in $fields)
    DEBUG: field[${foreach.index}] = ${field.fieldName} (${field.javaType})
#end
```

---

#### æŠ€å·§2: æ¡ä»¶åˆ¤æ–­è°ƒè¯•

```velocity
## è°ƒè¯•:æ£€æŸ¥æ¡ä»¶
#if($field.isPrimaryKey)
    DEBUG: This is primary key
#else
    DEBUG: This is NOT primary key
#end
```

---

#### æŠ€å·§3: ä½¿ç”¨å•å…ƒæµ‹è¯•

```kotlin
@Test
fun `debug template rendering`() {
    val context = mapOf(
        "className" to "User",
        "fields" to emptyList<Any>()
    )

    val result = VelocityTemplateRenderer.INSTANCE.renderString(
        """
        Class: ${className}
        Fields: ${fields.size()}
        """.trimIndent(),
        VelocityContextBuilder.create(context)
    )

    println("=== Rendered Result ===")
    println(result)
}
```

---

### 6.3 æ€§èƒ½é—®é¢˜è°ƒè¯•

#### é—®é¢˜: æ¨¡æ¿æ¸²æŸ“æ…¢

**æ’æŸ¥æ­¥éª¤**:

1. **æ£€æŸ¥å¾ªç¯åµŒå¥—æ·±åº¦**:

```velocity
## âŒ ä¸‰å±‚åµŒå¥—,æ€§èƒ½å·®
#foreach($aggregate in $aggregates)
    #foreach($entity in $aggregate.entities)
        #foreach($field in $entity.fields)
            ## ...
        #end
    #end
#end
```

2. **ä¼˜åŒ–æ–¹æ¡ˆ**: å‡å°‘åµŒå¥—,æå‰è®¡ç®—

```velocity
## âœ… æ‹†åˆ†å¾ªç¯
#foreach($aggregate in $aggregates)
    #set($totalFields = 0)
    #foreach($entity in $aggregate.entities)
        #set($totalFields = $totalFields + $entity.fields.size())
    #end
    Total fields: $totalFields
#end
```

3. **å¯ç”¨æ¨¡æ¿ç¼“å­˜**:

```kotlin
VelocityConfig(
    cacheEnabled = true  // å¯ç”¨ç¼“å­˜
)
```

---

### 6.4 ç¼–ç é—®é¢˜

#### é—®é¢˜: ç”Ÿæˆæ–‡ä»¶ä¸­æ–‡ä¹±ç 

**åŸå› **: ç¼–ç é…ç½®ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**:

```kotlin
// 1. é…ç½® Velocity ç¼–ç 
VelocityConfig(
    encoding = "UTF-8"
)

// 2. ç¡®ä¿æ¨¡æ¿æ–‡ä»¶æ˜¯ UTF-8 ç¼–ç 
// 3. å†™å…¥æ–‡ä»¶æ—¶æŒ‡å®šç¼–ç 
File("output/User.java").writeText(result, Charsets.UTF_8)
```

---

## ä¸ƒã€è¿›é˜¶ä¸»é¢˜

### 7.1 è‡ªå®šä¹‰å·¥å…·ç±»

**éœ€æ±‚**: æ·»åŠ è‡ªå®šä¹‰å·¥å…·ç±»åˆ°æ¨¡æ¿ä¸Šä¸‹æ–‡

**Step 1: åˆ›å»ºå·¥å…·ç±»**:

```kotlin
// velocity/tools/CodeUtils.kt
object CodeUtils {
    /**
     * ç”Ÿæˆ getter æ–¹æ³•å
     */
    fun getterName(fieldName: String, javaType: String): String {
        val prefix = if (javaType == "Boolean" || javaType == "boolean") "is" else "get"
        return prefix + fieldName.replaceFirstChar { it.uppercase() }
    }

    /**
     * ç”Ÿæˆ setter æ–¹æ³•å
     */
    fun setterName(fieldName: String): String {
        return "set" + fieldName.replaceFirstChar { it.uppercase() }
    }

    /**
     * åˆ¤æ–­æ˜¯å¦åŸºç¡€ç±»å‹
     */
    fun isPrimitive(javaType: String): Boolean {
        return javaType in setOf("int", "long", "double", "float", "boolean", "char", "byte", "short")
    }
}
```

---

**Step 2: æ³¨å†Œåˆ°ä¸Šä¸‹æ–‡**:

```kotlin
val velocityContext = VelocityContextBuilder()
    .putAll(context)
    .putTool("CodeUtils", CodeUtils)  // æ³¨å†Œå·¥å…·ç±»
    .build()
```

---

**Step 3: åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨**:

```velocity
#foreach($field in $fields)
    ## ç”Ÿæˆ getter
    public ${field.javaType} ${CodeUtils.getterName($field.fieldName, $field.javaType)}() {
        return this.${field.fieldName};
    }

    ## ç”Ÿæˆ setter
    #if(!$CodeUtils.isPrimitive($field.javaType))
    public void ${CodeUtils.setterName($field.fieldName)}(${field.javaType} ${field.fieldName}) {
        this.${field.fieldName} = ${field.fieldName};
    }
    #end
#end
```

---

### 7.2 æ¡ä»¶æ¨¡æ¿åŠ è½½

**éœ€æ±‚**: æ ¹æ®é…ç½®åŠ¨æ€é€‰æ‹©æ¨¡æ¿

**å®ç°**:

```kotlin
fun selectTemplate(useKotlin: Boolean): String {
    return if (useKotlin) {
        "vm/entity/entity.kt.vm"
    } else {
        "vm/entity/entity.java.vm"
    }
}

val templatePath = selectTemplate(project.hasProperty("kotlin"))
val result = VelocityTemplateRenderer.INSTANCE.render(
    templatePath,
    velocityContext
)
```

---

### 7.3 æ¨¡æ¿ç»§æ‰¿

**éœ€æ±‚**: åˆ›å»ºæ¨¡æ¿åŸºç±»,å­æ¨¡æ¿ç»§æ‰¿å…¬å…±éƒ¨åˆ†

**base-entity.java.vm**(åŸºç±»æ¨¡æ¿):

```velocity
package ${basePackage}.${moduleName}.domain.entity;

import lombok.Data;

/**
 * ${className}
 */
@Data
public class ${className} {
    ## åŸºç¡€å­—æ®µ
    private Long id;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;

    ## å­æ¨¡æ¿æ‰©å±•ç‚¹
    #parse("${extensionTemplate}")
}
```

---

**user-entity-extension.vm**(æ‰©å±•æ¨¡æ¿):

```velocity
## ç”¨æˆ·ç‰¹æœ‰å­—æ®µ
private String username;
private String email;
private String password;
```

---

**ä½¿ç”¨**:

```kotlin
val context = mapOf(
    "basePackage" to "com.example",
    "moduleName" to "user",
    "className" to "User",
    "extensionTemplate" to "vm/entity/user-entity-extension.vm"
)
```

---

## å…«ã€æ¨¡æ¿åº“å‚è€ƒ

### 8.1 å†…ç½®æ¨¡æ¿åˆ—è¡¨

| æ¨¡æ¿æ–‡ä»¶               | ç”¨é€”         | è¾“å‡ºæ–‡ä»¶                          |
|--------------------|------------|-------------------------------|
| entity.java.vm     | JPA å®ä½“ç±»    | {ClassName}.java              |
| entity.kt.vm       | Kotlin å®ä½“ç±» | {ClassName}.kt                |
| enum.java.vm       | æšä¸¾ç±»        | {EnumName}.java               |
| aggregate.md.vm    | èšåˆæ–‡æ¡£       | {AggregateName}_aggregate.md  |
| factory.java.vm    | å·¥å‚ç±»        | {ClassName}Factory.java       |
| repository.java.vm | ä»“å‚¨æ¥å£       | {ClassName}Repository.java    |
| jpa-impl.java.vm   | JPA ä»“å‚¨å®ç°   | Jpa{ClassName}Repository.java |
| schema.md.vm       | Schema æ–‡æ¡£  | schema.md                     |

---

### 8.2 æ¨¡æ¿ä¸‹è½½

**å®˜æ–¹æ¨¡æ¿åº“**: https://github.com/only4/cap4k-templates

**ç›®å½•ç»“æ„**:

```
cap4k-templates/
â”œâ”€â”€ java/
â”‚   â”œâ”€â”€ jpa/
â”‚   â”œâ”€â”€ mybatis/
â”‚   â””â”€â”€ jdbc/
â”œâ”€â”€ kotlin/
â”‚   â””â”€â”€ coroutines/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ markdown/
â”‚   â””â”€â”€ asciidoc/
â””â”€â”€ custom/
    â””â”€â”€ enterprise/
```

---

## ä¹ã€æ€»ç»“

### 9.1 å…³é”®è¦ç‚¹

1. âœ… Velocity è¯­æ³•ç®€æ´å¼ºå¤§,æ”¯æŒæ¡ä»¶ã€å¾ªç¯ã€å®
2. âœ… cap4k æä¾›å®Œæ•´çš„ä¸Šä¸‹æ–‡å˜é‡ç³»ç»Ÿ
3. âœ… æ¨¡æ¿å¼€å‘éµå¾ªè§„èŒƒ,æé«˜å¯ç»´æŠ¤æ€§
4. âœ… ä½¿ç”¨å·¥å…·ç±»å¢å¼ºæ¨¡æ¿èƒ½åŠ›
5. âœ… å……åˆ†æµ‹è¯•,ç¡®ä¿æ¨¡æ¿è´¨é‡

---

### 9.2 å­¦ä¹ è·¯å¾„

**åˆçº§** (1-2å¤©):

- âœ… æŒæ¡ Velocity åŸºæœ¬è¯­æ³•
- âœ… äº†è§£ cap4k ä¸Šä¸‹æ–‡å˜é‡
- âœ… ç¼–å†™ç®€å•æ¨¡æ¿(å®ä½“ç±»ã€æ–‡æ¡£)

**ä¸­çº§** (3-5å¤©):

- âœ… æŒæ¡è¿›é˜¶è¯­æ³•(å®ã€#parse)
- âœ… ä½¿ç”¨å·¥å…·ç±»
- âœ… ç¼–å†™å¤æ‚æ¨¡æ¿(ä»“å‚¨ã€æœåŠ¡å±‚)

**é«˜çº§** (1-2å‘¨):

- âœ… è‡ªå®šä¹‰å·¥å…·ç±»
- âœ… æ¨¡æ¿ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜
- âœ… æ„å»ºä¼ä¸šçº§æ¨¡æ¿åº“

---

### 9.3 å‚è€ƒèµ„æº

**å®˜æ–¹æ–‡æ¡£**:

- **Velocity User Guide**: https://velocity.apache.org/engine/2.3/user-guide.html
- **VTL Reference**: https://velocity.apache.org/engine/2.3/vtl-reference.html

**ç¤¾åŒºèµ„æº**:

- **Cap4k æ¨¡æ¿åº“**: https://github.com/only4/cap4k-templates
- **ç¤ºä¾‹é¡¹ç›®**: https://github.com/only4/cap4k-examples

**ä¹¦ç±æ¨è**:

- ã€ŠApache Velocity å®æˆ˜ã€‹
- ã€Šä»£ç ç”Ÿæˆå™¨è®¾è®¡ä¸å®ç°ã€‹

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2024-12-21
**ä½œè€…**: cap4k-codegen team

---

## é™„å½•

### A. Velocity å¿«é€Ÿå‚è€ƒå¡

**å˜é‡**:

```velocity
${variable}              ## è¾“å‡ºå˜é‡
$!{variable}             ## é™é»˜è¾“å‡º
${variable.property}     ## è®¿é—®å±æ€§
${variable.method()}     ## è°ƒç”¨æ–¹æ³•
```

**æ¡ä»¶**:

```velocity
#if($condition)...#end
#if($condition)...#else...#end
#if($c1)...#elseif($c2)...#else...#end
```

**å¾ªç¯**:

```velocity
#foreach($item in $list)..#end
$foreach.count           ## 1-based
$foreach.index           ## 0-based
$foreach.hasNext
```

**å®**:

```velocity
#macro(name $param)...#end
#name($arg)              ## è°ƒç”¨
```

**å¼•å…¥**:

```velocity
#parse("file.vm")        ## è§£æ
#include("file.txt")     ## åŸæ ·åŒ…å«
```

---

### B. Cap4k ä¸Šä¸‹æ–‡å˜é‡é€ŸæŸ¥

| å˜é‡          | ç±»å‹           | è¯´æ˜   |
|-------------|--------------|------|
| basePackage | String       | åŸºç¡€åŒ…å |
| moduleName  | String       | æ¨¡å—å  |
| className   | String       | ç±»å   |
| tableName   | String       | è¡¨å   |
| fields      | List<Field>  | å­—æ®µåˆ—è¡¨ |
| entities    | List<Entity> | å®ä½“åˆ—è¡¨ |
| author      | String       | ä½œè€…   |
| datetime    | String       | æ—¥æœŸæ—¶é—´ |

---

### C. å¸¸è§é”™è¯¯é€ŸæŸ¥

| é”™è¯¯                            | åŸå›        | è§£å†³         |
|-------------------------------|----------|------------|
| Unable to find resource 'var' | å˜é‡æœªå®šä¹‰    | æ£€æŸ¥ä¸Šä¸‹æ–‡      |
| Encountered "#ned"            | æ‹¼å†™é”™è¯¯     | æ”¹ä¸º #end    |
| Was expecting: ")"            | æ‹¬å·ä¸åŒ¹é…    | è¡¥å…¨æ‹¬å·       |
| NullPointerException          | å˜é‡ä¸º null | ä½¿ç”¨ $!{var} |

---

**END OF DOCUMENT**
